# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.

# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Yul block contains `return` function call.](#h-1-yul-block-contains-return-function-call)
  - [H-2: Contract locks Ether without a withdraw function.](#h-2-contract-locks-ether-without-a-withdraw-function)
- [Low Issues](#low-issues)
  - [L-1: Define and use `constant` variables instead of using literals](#l-1-define-and-use-constant-variables-instead-of-using-literals)

# Summary

## Files Summary

| Key         | Value |
| ----------- | ----- |
| .sol Files  | 11    |
| Total nSLOC | 531   |

## Files Details

| Filepath                                        | nSLOC   |
| ----------------------------------------------- | ------- |
| contracts/CometCollateralSwap.sol               | 133     |
| contracts/CometFoundation.sol                   | 49      |
| contracts/CometMultiplier.sol                   | 2       |
| contracts/plugins/flashloan/AAVEPlugin.sol      | 2       |
| contracts/plugins/flashloan/BalancerPlugin.sol  | 50      |
| contracts/plugins/flashloan/EulerV2Plugin.sol   | 41      |
| contracts/plugins/flashloan/MorphoPlugin.sol    | 89      |
| contracts/plugins/flashloan/UniswapV3Plugin.sol | 91      |
| contracts/plugins/swap/LiFiPlugin.sol           | 70      |
| contracts/plugins/swap/OneInchV6Plugin.sol      | 2       |
| contracts/plugins/swap/WstEthPlugin.sol         | 2       |
| **Total**                                       | **531** |

## Issue Summary

| Category | No. of Issues |
| -------- | ------------- |
| High     | 2             |
| Low      | 1             |

# High Issues

## H-1: Yul block contains `return` function call.

Remove this, as this causes execution to halt. Nothing after that call will execute, including code following the assembly block.

<details><summary>2 Found Instances</summary>

- Found in contracts/CometCollateralSwap.sol [Line: 134](contracts/CometCollateralSwap.sol#L134)

  ```solidity
              return(0x00, 0x20)
  ```

- Found in contracts/CometMultiplier.sol [Line: 70](contracts/CometMultiplier.sol#L70)

  ```solidity
              return(0x00, 0x20)
  ```

</details>

## H-2: Contract locks Ether without a withdraw function.

It appears that the contract includes a payable function to accept Ether but lacks a corresponding function to withdraw it, which leads to the Ether being locked in the contract. To resolve this issue, please implement a public or external function that allows for the withdrawal of Ether from the contract.

<details><summary>8 Found Instances</summary>

- Found in contracts/CometCollateralSwap.sol [Line: 56](contracts/CometCollateralSwap.sol#L56)

  ```solidity
  contract CometCollateralSwap is CometFoundation, ICometCollateralSwap {
  ```

- Found in contracts/CometFoundation.sol [Line: 23](contracts/CometFoundation.sol#L23)

  ```solidity
  contract CometFoundation {
  ```

- Found in contracts/CometMultiplier.sol [Line: 28](contracts/CometMultiplier.sol#L28)

  ```solidity
  contract CometMultiplier is CometFoundation, ReentrancyGuard, ICometMultiplier {
  ```

- Found in contracts/plugins/flashloan/AAVEPlugin.sol [Line: 21](contracts/plugins/flashloan/AAVEPlugin.sol#L21)

  ```solidity
  contract AAVEPlugin is ICometFlashLoanPlugin {
  ```

- Found in contracts/plugins/flashloan/BalancerPlugin.sol [Line: 20](contracts/plugins/flashloan/BalancerPlugin.sol#L20)

  ```solidity
  contract BalancerPlugin is IFlashLoanRecipient, ICometFlashLoanPlugin {
  ```

- Found in contracts/plugins/flashloan/EulerV2Plugin.sol [Line: 20](contracts/plugins/flashloan/EulerV2Plugin.sol#L20)

  ```solidity
  contract EulerV2Plugin is ICometFlashLoanPlugin {
  ```

- Found in contracts/plugins/flashloan/MorphoPlugin.sol [Line: 19](contracts/plugins/flashloan/MorphoPlugin.sol#L19)

  ```solidity
  contract MorphoPlugin is ICometFlashLoanPlugin {
  ```

- Found in contracts/plugins/flashloan/UniswapV3Plugin.sol [Line: 19](contracts/plugins/flashloan/UniswapV3Plugin.sol#L19)

  ```solidity
  contract UniswapV3Plugin is ICometFlashLoanPlugin {
  ```

</details>

# Low Issues

## L-1: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>8 Found Instances</summary>

- Found in contracts/CometMultiplier.sol [Line: 315](contracts/CometMultiplier.sol#L315)

  ```solidity
                          10 ** AggregatorV3Interface(info.priceFeed).decimals()
  ```

- Found in contracts/CometMultiplier.sol [Line: 338](contracts/CometMultiplier.sol#L338)

  ```solidity
          uint256 den = (10 ** AggregatorV3Interface(priceFeed).decimals() * info.scale) * FACTOR_SCALE;
  ```

- Found in contracts/plugins/swap/LiFiPlugin.sol [Line: 74](contracts/plugins/swap/LiFiPlugin.sol#L74)

  ```solidity
          require(swapData.length > 4, ICA.InvalidSwapParameters());
  ```

- Found in contracts/plugins/swap/LiFiPlugin.sol [Line: 75](contracts/plugins/swap/LiFiPlugin.sol#L75)

  ```solidity
          require(bytes4(swapData[:4]) == SWAP_SELECTOR, ICA.InvalidSelector());
  ```

- Found in contracts/plugins/swap/LiFiPlugin.sol [Line: 86](contracts/plugins/swap/LiFiPlugin.sol#L86)

  ```solidity
          ) = abi.decode(swapData[4:], (bytes32, string, string, address, uint256, ILiFi.SwapData[]));
  ```

- Found in contracts/plugins/swap/OneInchV6Plugin.sol [Line: 68](contracts/plugins/swap/OneInchV6Plugin.sol#L68)

  ```solidity
          require(swapData.length > 4, ICA.InvalidSwapParameters());
  ```

- Found in contracts/plugins/swap/OneInchV6Plugin.sol [Line: 69](contracts/plugins/swap/OneInchV6Plugin.sol#L69)

  ```solidity
          require(bytes4(swapData[:4]) == SWAP_SELECTOR, ICA.InvalidSelector());
  ```

- Found in contracts/plugins/swap/OneInchV6Plugin.sol [Line: 76](contracts/plugins/swap/OneInchV6Plugin.sol#L76)

  ```solidity
          ) = abi.decode(swapData[4:], (address, IOneInchV6.SwapDescription, bytes));
  ```

</details>
